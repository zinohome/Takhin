# Takhin 压缩性能基准测试报告

## 测试环境

- **CPU**: Intel Core i9-12900HK (12th Gen)
- **OS**: macOS (darwin/amd64)
- **Go Version**: Go 1.21+
- **测试时间**: 2025-12-17
- **基准测试时长**: 5秒/测试

## 性能测试结果

### 压缩性能对比

| 算法 | 操作数/秒 | 平均耗时 (ns/op) | 内存分配 (B/op) | 分配次数 (allocs/op) |
|------|----------|-----------------|----------------|-------------------|
| **压缩** ||||
| Snappy | 4,470,888 | 1,321 | 5,376 | 1 |
| LZ4 | 3,578,353 | 1,689 | 794 | 8 |
| GZIP | 45,381 | 127,986 | 814,101 | 20 |
| ZSTD | 19,066 | 315,431 | 2,346,828 | 48 |
| **解压** ||||
| Snappy | 4,813,538 | 1,234 | 4,864 | 1 |
| GZIP | 521,528 | 11,171 | 58,640 | 13 |
| ZSTD | 313,593 | 21,014 | 38,173 | 44 |
| LZ4 | 18,684 | 327,448 | 4,251,079 | 18 |

### 压缩率对比（测试数据：2250 字节重复文本）

| 算法 | 原始大小 | 压缩后大小 | 压缩率 | 排名 |
|------|---------|-----------|--------|------|
| ZSTD | 2,250 | 69 | 3.07% | 🥇 最佳 |
| GZIP | 2,250 | 87 | 3.87% | 🥈 |
| LZ4 | 2,250 | 94 | 4.18% | 🥉 |
| Snappy | 2,250 | 153 | 6.80% | - |
| None | 2,250 | 2,250 | 100% | - |

### 大数据压缩测试（129,000 字节 JSON 日志）

| 算法 | 压缩后大小 | 压缩率 | 压缩速度排名 |
|------|-----------|--------|------------|
| ZSTD | 136 | 0.11% | 最慢 |
| GZIP | 661 | 0.51% | 慢 |
| LZ4 | 679 | 0.53% | 快 |
| Snappy | 6,293 | 4.88% | 最快 |

## 性能分析

### 1. 速度性能

#### 压缩速度排名
1. **Snappy** - 1.3 µs/op ⭐⭐⭐⭐⭐
   - 吞吐量: 4.47M ops/s
   - 最快的压缩算法
   - 内存分配最少（5.3 KB）
   
2. **LZ4** - 1.7 µs/op ⭐⭐⭐⭐
   - 吞吐量: 3.58M ops/s
   - 次快速度
   - 内存分配极少（794 B）
   
3. **GZIP** - 128 µs/op ⭐⭐
   - 吞吐量: 45K ops/s
   - 中等速度
   - 较高内存分配（814 KB）
   
4. **ZSTD** - 315 µs/op ⭐
   - 吞吐量: 19K ops/s
   - 最慢压缩
   - 最高内存分配（2.3 MB）

#### 解压速度排名
1. **Snappy** - 1.2 µs/op ⭐⭐⭐⭐⭐
   - 吞吐量: 4.81M ops/s
   - 最快解压
   - 内存分配少（4.8 KB）
   
2. **GZIP** - 11 µs/op ⭐⭐⭐⭐
   - 吞吐量: 521K ops/s
   - 次快解压
   - 中等内存分配（58 KB）
   
3. **ZSTD** - 21 µs/op ⭐⭐⭐
   - 吞吐量: 313K ops/s
   - 中等解压速度
   - 较低内存分配（38 KB）
   
4. **LZ4** - 327 µs/op ⭐
   - 吞吐量: 18K ops/s
   - 最慢解压
   - 高内存分配（4.2 MB）

### 2. 综合评分

| 算法 | 压缩速度 | 解压速度 | 压缩率 | 内存使用 | 综合评分 |
|------|---------|---------|--------|---------|---------|
| Snappy | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | **4.25/5** |
| GZIP | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ | **3.00/5** |
| LZ4 | ⭐⭐⭐⭐ | ⭐ | ⭐⭐⭐⭐ | ⭐⭐ | **2.75/5** |
| ZSTD | ⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐ | **2.50/5** |

## 使用场景推荐

### 1. 实时流处理场景 → **Snappy**
- **特点**: 最快的压缩/解压速度
- **适用**: 高吞吐量、低延迟要求
- **示例**: 实时日志收集、事件流处理
- **性能**: 4.5M ops/s 压缩 + 4.8M ops/s 解压

### 2. 通用场景 → **GZIP**
- **特点**: 平衡的压缩率和性能
- **适用**: 标准 Kafka 部署，通用消息队列
- **示例**: 微服务消息传递、数据同步
- **性能**: 45K ops/s 压缩 + 521K ops/s 解压

### 3. 存储密集型场景 → **ZSTD**
- **特点**: 最佳压缩率（0.11%）
- **适用**: 长期存储、归档、成本敏感
- **示例**: 日志归档、审计数据、冷数据
- **性能**: 19K ops/s 压缩 + 313K ops/s 解压

### 4. CPU 受限场景 → **LZ4**
- **特点**: 压缩快但解压慢
- **适用**: 写多读少的场景
- **示例**: 批量数据导入、一次写入多次读取
- **性能**: 3.6M ops/s 压缩 + 18K ops/s 解压

## 结论

1. **最快速度**: Snappy（压缩 + 解压都是最快）
2. **最佳压缩率**: ZSTD（特别是大数据集）
3. **最平衡**: GZIP（Kafka 标准，兼容性好）
4. **最省内存**: LZ4（压缩阶段仅 794 B）

### 推荐配置

| 场景 | 推荐算法 | 理由 |
|------|---------|------|
| 默认配置 | GZIP | 兼容性、平衡性 |
| 实时流 | Snappy | 速度优先 |
| 日志归档 | ZSTD | 存储优先 |
| 批量导入 | LZ4 | 写入优化 |
| 小消息 | None | 避免压缩开销 |
