# Takhin Configuration File
# All settings can be overridden using environment variables with TAKHIN_ prefix
# Example: TAKHIN_SERVER_PORT=9093

# Server Configuration
server:
  host: "0.0.0.0"
  port: 9092
  
  # TLS/SSL Configuration
  tls:
    enabled: false                    # Enable TLS encryption
    cert:
      file: ""                        # Path to server certificate (required if TLS enabled)
    key:
      file: ""                        # Path to server private key (required if TLS enabled)
    ca:
      file: ""                        # Path to CA certificate (for client verification)
    client:
      auth: "none"                    # Client authentication: none, request, require
    verify:
      client:
        cert: false                   # Verify client certificates (mTLS)
    min:
      version: "TLS1.2"               # Minimum TLS version: TLS1.0, TLS1.1, TLS1.2, TLS1.3
    cipher:
      suites: []                      # Custom cipher suites (empty = use defaults)
    prefer:
      server:
        cipher: false                 # Prefer server cipher suites

# Kafka Protocol Configuration
kafka:
  broker:
    id: 1
  
  # Cluster Configuration - List of all broker IDs in the cluster
  # If not specified, defaults to single-broker mode with current broker ID
  # Example for 3-broker cluster: [1, 2, 3]
  cluster:
    brokers: [1]  # Single broker by default, change for multi-broker setup
  
  listeners:
    - "tcp://0.0.0.0:9092"
  advertised:
    host: "localhost"
    port: 9092
  
  # Message and Connection Limits
  max:
    message:
      bytes: 1048576      # 1MB
    connections: 1000
  request:
    timeout:
      ms: 30000           # 30 seconds
  connection:
    timeout:
      ms: 60000           # 60 seconds

# Storage Configuration
storage:
  data:
    dir: "/tmp/takhin-data"
  
  # Log Segment Settings
  log:
    segment:
      size: 1073741824    # 1GB
    retention:
      hours: 168          # 7 days
      bytes: 0            # 0 = unlimited
    
    # Log Cleanup and Flush
    cleanup:
      interval:
        ms: 300000        # 5 minutes
    flush:
      interval:
        ms: 1000          # 1 second
      messages: 10000     # Flush after 10k messages
  
  # Background Cleaner Settings
  cleaner:
    enabled: true         # Enable background cleanup and compaction
  
  # Log Compaction Settings
  compaction:
    interval:
      ms: 600000          # 10 minutes
    min:
      cleanable:
        ratio: 0.5        # Compact when 50% is dirty

# Replication Configuration
replication:
  default:
    replication:
      factor: 1           # Default replication factor (1 = no replication)
  replica:
    lag:
      time:
        max:
          ms: 10000       # 10 seconds - max lag before removing from ISR
    fetch:
      wait:
        max:
          ms: 500         # Follower fetch wait time
      max:
        bytes: 1048576    # 1MB - max bytes per follower fetch

# Raft Consensus Configuration (Leader Election Optimization)
raft:
  # Heartbeat and Election Timeouts (optimized for fast elections)
  heartbeat:
    timeout:
      ms: 1000            # 1 second - time without leader contact before election
  election:
    timeout:
      ms: 3000            # 3 seconds - max election duration (target < 5s)
  leader:
    lease:
      timeout:
        ms: 500           # 500ms - leader lease timeout
  commit:
    timeout:
      ms: 50              # 50ms - commit timeout for log replication
  
  # Snapshot Configuration
  snapshot:
    interval:
      ms: 120000          # 2 minutes - snapshot interval
    threshold: 8192       # Number of logs before snapshot
  
  # PreVote Configuration (reduces unnecessary elections)
  prevote:
    enabled: true         # Enable PreVote to avoid election storms
  
  # Append Entries Configuration
  max:
    append:
      entries: 64         # Max entries per AppendEntries RPC

# Logging Configuration
logging:
  level: "info"     # debug, info, warn, error
  format: "json"    # json, text

# Metrics Configuration
metrics:
  enabled: true
  host: "0.0.0.0"
  port: 9090
  path: "/metrics"

# ACL Configuration
acl:
  enabled: false      # Enable ACL authorization (disabled by default)

